## The Business Challenge

```{r}
#| warning: false
#| echo: false
library(tidyverse)
library(ggplot2)
library(scales) 
library(ggokabeito)
library(ggthemes) 
library(patchwork) 
library(stringr)
library(RColorBrewer)
```

```{r}
#| warning: false
#| eval: true
#| echo: false
#| cache: true

# Create data/ directory if it doesn't exist
if (!dir.exists("data")) {
  dir.create("data")
}
# Define URL and destination file path
url <- "https://raw.githubusercontent.com/unimelb-cmce-10002/fba-book/refs/heads/main/data/asx_200_2024.csv"
destfile <- "data/asx_200_2024.csv"
# Download the file if it doesn't already exist
if (!file.exists(destfile)) {
  download.file(url, destfile, mode = "wb")
}
# Load the data
asx_200_2024 <- read_csv(destfile)
```

### The Topic: Understanding firm strategy in the Australian economy{.unnumbered}

In the lecture, we examined the level of firms’ profits and the efficiency with which firms use investors’ capital to produce these profits (i.e., returns as a measure of profitability). However, we have yet to examine variation in 'how' firms produce profits. Broadly speaking, firms can pursue one of two strategies. Firms can employ a high-margin, low-volume strategy, or a low-margin, high-volume strategy. The former rely on pricing power or operational efficiencies that drive down costs in order to produce more profit per unit of good or services sold. The latter rely on scaling up operations and distribution in order to sell at very high volumes goods or services that provide much less profit per unit.

We calculate a firm's profit margin as follows:

$$
\mathrm{Profit\ Margin} = \frac{\mathrm{EBIT}}{\mathrm{Sales}}
$$

Firms that effectively employ a high-margin, low-volume strategy have high profit margins (i.e., these firms generate more profit from each dollar of sales).

We calculate a firm’s asset turnover as follows:

$$
\mathrm{Asset\ Turnover} = \frac{\mathrm{Sales}}{\mathrm{Assets}}
$$

Firms that effectively employ a low-margin, high-volume strategy have high asset turnover (i.e., these firms generate more sales from a given asset base).

In the following exercises we will explore research questions such as the following: 

- How does firm strategy vary by firm size and industry? 
- Do we observe companies that successfully maintain high margins and high volumes, and if so, which types of companies fall into this category? 
- Do we observe the inverse-i.e., companies that suffer from low margins and low volume? 
- And, perhaps most importantly, how does firm strategy relate to profitability?

### The Data: Financial Statement Observations from Yahoo Finance{.unnumbered}

To answer these questions, we draw on audited 2024 financial statements for the 200 largest ASX-listed firms (as measured by assets). This data set should be familiar to you from the lecture.  

Financial statements provide a standardised snapshot of a company’s performance and financial health. In our data set, the key variables are:  

- Company name (`conml`) – the name of the firm as listed on the ASX  
- Industry (`industry`) – the industry classification, allowing comparison across sectors such as mining, banking, or healthcare  
- Profit (`ebit`) – earnings before interest and taxes, representing core business profit after expenses (from the income statement)  
- Assets (`at`) – the total resources the company owns that have economic value (from the balance sheet)  
- Invested Capital (`invested_capital`) – the total capital invested in the company by both shareholders and debt holders to fund operations and growth. It generally includes:  
  - Equity (`shareequity`) – the funds contributed by shareholders plus retained earnings  
  - Interest-bearing debt (`dlc`, `dltt`, `dvp`) – loans and borrowings the company uses for financing

By working with these statements and variables, we can replicate the kind of assessments that professional analysts and fund managers use to guide billion-dollar investment decisions.  

As you will see, just a few lines of R code can wrangle raw financial statements information into orderly data that we can effectively visualize.

**From this:**

```{r}
#| echo: false 
asx_200_2024 %>%
    head(10)
```

**To this:**

```{r}
#| fig-width: 6
#| fig-height: 6
#| fig-align: "center"
#| echo: false
#| warning: false

firm_strategy <- asx_200_2024 %>%
  filter(invested_capital > 0 & at > 0 & sale > 0) %>% # Drop observations where we would have to divide by zero when calculating our new variables
  mutate(roic = ebit/invested_capital,
         profit_margin = ebit/sale,
         asset_turnover = sale/at)

firm_strategy %>% 
      filter(profit_margin > -2) %>% 
      ggplot() + 
        geom_point(aes(x = asset_turnover, y = profit_margin, fill = cut(roic, 
                   breaks = 3, labels = c("Low", "Medium", "High"))), 
                   alpha = 0.7, shape = 21, color = "black", size = 4) + 
        geom_vline(xintercept = median(firm_strategy$asset_turnover, na.rm = TRUE), 
                   linetype = "dashed", color = "blue", size = 1) + 
        geom_hline(yintercept = median(firm_strategy$profit_margin, na.rm = TRUE), 
                   linetype = "dashed", color = "blue", size = 1) + 
        scale_fill_manual(values = c("Low" = "red", "Medium" = "orange", "High" = "green")) + 
        theme_minimal() + 
        labs(title = "Firm Strategy: Large Australian Public Companies (2024)", 
             x = "Asset Turnover", 
             y = "Profit Margin") + 
        guides(color = guide_legend(title = NULL), 
               fill = guide_legend(title = "ROIC"))
```
## Loading the Data

### R packages for today {.unnumbered}

```{r}
#| eval: false
library(tidyverse)     # collection of packages for data manipulation and visualization
library(scales)        # for formatting and transforming axis scales
library(ggokabeito)    # color blind friendly color palette — this course's default
library(ggthemes)      # additional ggplot themes for polished, publication-ready plots
library(patchwork)     # for combining multiple ggplots into one figure
library(stringr)       # for working with strings using consistent functions
library(RColorBrewer) # color palette
```

### Loading the Data in R {.unnumbered}

```{r}
#| warning: false
#| eval: false
#| echo: true
#| label: load-asx-data
#| cache: true

asx_200_2024 <-
    read_csv("data/asx_200_2024.csv")
```
