<!-- question-type: inclass -->
### Exercise 4: Identifying and removing outliers to improve the profit margin histogram

In exercise 1, we created the following plot:

```{r}
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"
#| echo: false
#| warning: false

firm_strategy |>
    ggplot(aes(x = profit_margin)) + 
    geom_histogram(fill = "darkorange", color = "black", 
                 alpha = 0.7, bins = 100) +
    labs(title = "Distribution of Profit Margin for Sample of Large ASX Companies in 2024",  
             x = "Profit Margin",  
             y = "Frequency") +  
    theme_minimal() 
```

**(a).** We have two extreme observations in the left tail of our distribution. Create a short, narrow table that isolates these observations and shows only the sub-set of variables that relate to profit margin and asset turnover. Using this table, explains why these firms have such extreme (negative) profit margins. Use the starter code below to create and display such a table.

```{r, eval=FALSE}
YOUR_DATAFRAME |>
    YOUR_FUNCTION_NAME(YOUR_VARIABLE_NAME) |>
    YOUR_FUNCTION_NAME(2) |>
    YOUR_FUNCTION_NAME(conml, industry, ebit, at, sale, profit_margin, asset_turnover)
```

**(b).** These extreme observations badly drag out our distribution‚Äôs left tail, and so compress our visualization of the rest of the distribution (i.e., the vast majority of firms in our sample are pushed into a single column even though there is much variation in these firms' profit margins). Use the starter code below to remove these outliers from our sample and then create a basic histogram that visualizes the distribution of profit for our ‚Äòpruned‚Äô sample.

```{r, eval=FALSE}
YOUR_DATAFRAME |>
    YOUR_FUNCTION_NAME(YOUR_VARIABLE_NAME > YOUR_LOWER_BOUND_VALUE) |>
    YOUR_FUNCTION_NAME(aes(x = YOUR_VARIABLE_NAME)) + 
    YOUR_FUNCTION_NAME(fill = "darkorange", color = "black", 
                       alpha = 0.7, bins = 100
                       ) +  
    labs(title = "Distribution of Profit Margin for Sample of Large ASX Companies in 2024", 
         x = YOUR_LABEL, 
         y = YOUR_LABEL
         ) + 
    theme_minimal() 
```

**(c).** Hmm! Explain whether you think the plot above effectively visualizes the distribution of profit margin for large Australian public companies. Do we still have extreme observations in our left tail? How do these affect what we can learn about the majority of firms, which exhibit profit margins >= 0?

**(d).** Use the starter code below to further ‚Äòprune‚Äô our sample and so again visualize the distribution of profit margin for large Australian public companies. Do we now get a better sense of our how profit margin is distributed across large Australian companies?

```{r, eval=FALSE}
YOUR_DATAFRAME |>
    YOUR_FUNCTION_NAME(YOUR_VARIABLE_NAME > YOUR_HIGHER_LOWER_BOUND_VALUE) |>
    YOUR_FUNCTION_NAME(aes(x = YOUR_VARIABLE_NAME)) + 
    YOUR_FUNCTION_NAME(fill = "darkorange", color = "black", 
                       alpha = 0.7, bins = 100
                       ) +  
    labs(title = "Distribution of Profit Margin for Sample of Large ASX Companies in 2024", 
         x = YOUR_LABEL, 
         y = YOUR_LABEL
         ) + 
    theme_minimal() 
```

**(e).** Using the plot produced above, what would you consider to be the typical large Australian company‚Äôs profit margin? What would you consider a high-margin firm to be? Explain why it is not possible for the distribution of profit margin to have a very long right tail (i.e., firms that enjoy extremely large profit margins)?

<!-- BEGIN PROFILE:r-teaching-guide -->
::: {.content-visible when-profile="r-teaching-guide"}

::: {.teaching-block}

::: {.teaching-block-header}
Teaching Note
:::

::: {.teaching-block-body}

üéØ **Learning Objective** 

Students should:

- Use `arrange()` and `head()` to identify extreme observations in a dataset.
- Apply `filter()` to trim or exclude outliers for clearer data visualization.
- Understand how extreme values can distort histograms and hide variation in the main body of the data.
- Interpret histograms to identify ‚Äútypical‚Äù values and define high/low extremes in context.

‚úÖ   **Core Concepts to Highlight**

- Outliers in profit margin often result from very small sales denominators ‚Äî especially in early-stage firms ‚Äî causing disproportionately large negative values.
- Even after trimming, a few extreme cases can stretch the x-axis and compress the visible range where most observations lie.
- Narrowing the x-axis range or further filtering allows bins to better represent the true variation in the main cluster.
- Profit margins have a natural ceiling (EBIT ‚â§ sales) limiting the right tail, but the left tail can extend far due to near-zero sales.

üí¨ **Suggested In-Class Prompts** (if needed)

"After running arrange(profit_margin) and inspecting the top/bottom rows, what do you notice about sales for these extreme cases?"

"How does changing the filter threshold in filter(profit_margin > X) affect the shape of the histogram?"

"Where would you place the ‚Äútypical‚Äù firm‚Äôs profit margin in the trimmed histogram, and what industries might dominate that range?"

"Why can the left tail be extremely long, but the right tail cannot?"

üìå **Common Misunderstandings**

- Believing extreme negative margins always indicate poor operational performance, rather than an arithmetic effect of small denominators.
- Assuming histograms always show the ‚Äútrue‚Äù spread without considering the influence of scale compression.
- Forgetting that trimming or zooming in on a histogram is not ‚Äúcheating‚Äù ‚Äî it‚Äôs a way to make the distribution informative for the bulk of observations.
- Misinterpreting the absence of a long right tail as evidence that high margins are rare for purely economic reasons, rather than due to the EBIT ‚â§ sales constraint.

:::

:::

:::
<!-- END PROFILE:r-teaching-guide -->

<!-- BEGIN PROFILE:r-solutions -->
::: {.content-visible when-profile="r-solutions" when-profile="r-teaching-guide"}

::: {.solution-block}

::: {.solution-block-header}
Solution
:::

::: {.solution-block-body}

**(a). Isolating and examining outliers**

Here's the updated code:

```{r}
firm_strategy |>
  arrange(profit_margin) |>
  head(2) |>
  select(conml, industry, ebit, at, sale, profit_margin, asset_turnover)
```

This table shows how profit margin can appear extreme when sales are very small. For both firms listed, modest operating losses are divided by near-zero revenue, producing huge negative margins that don‚Äôt necessarily reflect worse underlying performance. Such cases are common in early-stage resource firms and can heavily distort the left tail of the profit-margin distribution, compressing the range where most firms fall.

**(b).   Trimming outliers to improve histogram**

Here's the updated code:

```{r}
firm_strategy |>
  filter(profit_margin > -897) |>
  ggplot(aes(x = profit_margin)) + 
  geom_histogram(fill = "darkorange", color = "black", 
                 alpha = 0.7, bins = 100
                 ) +  
  labs(title = "Distribution of Profit Margin for Sample of Large ASX Companies in 2024", 
       x = "Profit Margin", 
       y = "Frequency"
       ) + 
  theme_minimal() 
```

**(c).  Extreme observations are still compressing our histogram**

The plot does show the overall distribution of profit margins, but it‚Äôs not especially effective for understanding where most firms actually sit. We can see that there are still a handful of extreme left-tail observations ‚Äî with profit margins far below zero ‚Äî that stretch the x-axis. 

Because these extreme values dominate the scale, the bulk of the distribution (where most firms cluster at or above 0% profit margin) is still compressed into a narrow band on the right, making it hard to distinguish variation among the majority of companies. In practical terms, these outliers obscure differences between profitable firms and those with only slightly negative margins, limiting the insights we can gain about typical firm performance.

For a clearer view of most companies, it would be better to either zoom in on the main cluster-e.g., trimming more of the extreme left tail-so that the common range of profit margins is more visually informative.

**(d).   More heavily trimming outliers to improve histogram**

Here's the updated code:

```{r, warning=FALSE}
firm_strategy |>
  filter(profit_margin > -2) |>
  ggplot(aes(x = profit_margin)) + 
  geom_histogram(fill = "darkorange", color = "black", 
                 alpha = 0.7, bins = 100
                 ) +  
  labs(title = "Distribution of Profit Margin for Sample of Large ASX Companies in 2024", 
       x = "Profit Margin", 
       y = "Frequency"
       ) + 
  theme_minimal() 
```

By narrowing the x-axis range, this plot provides a much clearer and more informative picture of the distribution of profit margins for large ASX companies. In the earlier version, extreme negative outliers stretched the scale so much that the vast majority of firms‚Äîthose with margins between roughly 0 and 1‚Äîwere compressed into a tiny space, making it hard to see variation within that range.

Here, by excluding those extreme left-tail observations, the bins are more evenly distributed across the range where most firms lie. This prevents many companies from being lumped into a single bin and instead reveals meaningful differences in profitability within the main cluster. As a result, we can distinguish small but important shifts in margins around zero, rather than having them visually obscured by a few extreme cases.

**(e). Interpreting the profit margin histogram** 

From the above plot, the typical large Australian company appears to have a profit margin clustered just above zero, most likely in the range of 5%‚Äì15%. This reflects a healthy but moderate profitability level common among established public firms.

A high-margin firm in this context would be one with margins of 30% or more, which is relatively rare in the data set. Such firms tend to operate in industries with high pricing power, low variable costs, and barriers to competitor entry such as strong intellectual property protection, allowing them to convert a large share of revenue into profit.

It is not possible for the distribution to have a very long right tail because profit margin is calculated as

$$
\mathrm{Profit\ Margin} = \frac{\mathrm{EBIT}}{\mathrm{Sales}}
$$

Profit margin is right censored because EBIT by definition cannot exceed sales (a firm cannot make more operating profit than it earns in revenue). This imposes a hard upper bound on profit margin, unlike the left tail, where sales can approach zero while losses remain large, producing extreme negative values when firms operate at a heavy loss.

:::

:::

:::
<!-- END PROFILE:r-solutions -->